@model ShopVM

<div id="site-main" class="site-main">
	<div id="main-content" class="main-content">
		<div id="primary" class="content-area">
			<div id="title" class="page-title">
				<div class="section-container">
					<div class="content-title-heading">
						<h1 class="text-title-heading">
							Bed &amp; Bath
						</h1>
					</div>
					<div class="breadcrumbs">
						<a asp-controller="Home" asp-action="Index">Home</a><span class="delimiter"></span><a asp-controller="Shop" asp-action="Index">Shop</a><span class="delimiter"></span>Bed &amp; Bath
					</div>
				</div>
			</div>

			<div id="content" class="site-content" role="main">
				<div class="section-padding">
					<div class="section-container p-l-r">
						<div class="row">
							<div class="col-xl-3 col-lg-3 col-md-12 col-12 sidebar left-sidebar md-b-50">
								<!-- Block Product Categories -->
								<div class="block block-product-cats">
									<div class="block-title"><h2>Categories</h2></div>
									<div class="block-content">
										<div class="product-cats-list">
										    <ul id="categoryList">
												@foreach (var item in Model.Categories)
												{
													<li>
														<a href="javascript:void(0);" onclick="filterProducts('@item.Name', null, null, null)">
															@item.Name

															<span class="count">@ViewBag.CategoryProductCounts[item.Name]</span>
														</a>
													</li>
												}
											</ul>
										</div>
									</div>
								</div>

								<!-- Block Product Filter -->
								<div class="block block-product-filter">
									<div class="block-title"><h2>Price</h2></div>
									<div class="block-content">
										<div id="slider-range" class="price-filter-wrap">
											<div class="filter-item price-filter">
												<div class="layout-slider">
													<input id="price-filter" name="price" value="0;100" />
												</div>
												<div class="layout-slider-settings"></div>
											</div>
										</div>
									</div>
								</div>

							
								<!-- Block Product Filter -->
								<div class="block block-product-cats">
									<div class="block-title"><h2>Brands</h2></div>
									<div class="block-content">
										<div class="product-cats-list">
											<ul id="brandList">
												@foreach (var item in Model.Brands)
												{
													<li>
														<a href="javascript:void(0);" onclick="filterProducts(null, '@item.Name', null, null)">
															@item.Name
															<span class="count">@ViewBag.BrandProductCounts[item.Name]</span>
														</a>
													</li>
												}
											</ul>
										</div>
									</div>
								</div>

								<div class="block block-post-tags">
									<div class="block-title"><h2>Tags</h2></div>
									<div class="block-content">
										<div class="post-tags-list">
											<ul id="tagList">
											@foreach (var item in Model.Tags)
												{
													<li>
														<a href="javascript:void(0);" onclick="filterProducts(null, null, '@item.Name', null)">
															@item.Name

														</a>
													</li>

												}															
											</ul>
										</div>
									</div>
								</div>


								<!-- Block Products -->
								<div class="block block-products">
									<div class="block-title"><h2>New Product:</h2></div>
									<div class="block-content">
										<ul class="products-list">
											@foreach (var item in Model.Products.OrderByDescending(x=>x.CreatedDate).Take(3))
											{
												<li class="product-item">
													<a href="shop-details.html" class="product-image">
														<img src="@item.MainImage">
													</a>
													<div class="product-content">
														<h2 class="product-title">
															<a href="shop-details.html">
																@item.Name
															</a>
														</h2>
														<div class="rating small">
															<div class="star star-5"></div>
														</div>
														<span class="price">
															<del aria-hidden="true"><span>@item.Price</span></del>
														</span>
													</div>
												</li>

											}
											
										</ul>
									</div>
								</div>
							</div>

							<div class="col-xl-9 col-lg-9 col-md-12 col-12">
								<div class="products-topbar clearfix">
									<div class="products-topbar-left">
										<div class="products-count">
											Showing all 21 results
										</div>
									</div>
									<div class="products-topbar-right">						
										<div class="products-sort dropdown">
											<span class="sort-toggle dropdown-toggle" data-toggle="dropdown" aria-expanded="true">Sorting</span>
											<ul class="sort-list dropdown-menu">
												<li><a href="javascript:void(0);" onclick="sortProducts('A-Z')">A-Z</a></li>
												<li><a href="javascript:void(0);" onclick="sortProducts('Z-A')">Z-A</a></li>
												<li><a href="javascript:void(0);" onclick="sortProducts('Latest')">Sort By Latest</a></li>
												<li><a href="javascript:void(0);" onclick="sortProducts('PriceLowToHigh')">Sort By Price: Low To High</a></li>
												<li><a href="javascript:void(0);" onclick="sortProducts('PriceHighToLow')">Sort By Price: High To Low</a></li>
											</ul>
										</div>

										<ul class="layout-toggle nav nav-tabs">
											<li class="nav-item">
												<a class="layout-grid nav-link active" data-toggle="tab" href="#layout-grid" role="tab"><span class="icon-column"><span class="layer first"><span></span><span></span><span></span></span><span class="layer middle"><span></span><span></span><span></span></span><span class="layer last"><span></span><span></span><span></span></span></span></a>
											</li>
											<li class="nav-item">
												<a class="layout-list nav-link" data-toggle="tab" href="#layout-list" role="tab"><span class="icon-column"><span class="layer first"><span></span><span></span></span><span class="layer middle"><span></span><span></span></span><span class="layer last"><span></span><span></span></span></span></a>
											</li>
										</ul>
									</div>
								</div>

								<div class="tab-content">
									<div class="tab-pane fade show active" id="layout-grid" role="tabpanel">
										<div class="products-list grid">
											<input type="hidden" class="products-count" value="@ViewBag.ProductsCount" />
											<div class="row products-area" id="productsContainer">
												@await Html.PartialAsync("_ProductPartial", Model.Products)												
											</div>
											 <div class="btn-all"> 
											 	<button class="button-outline show-more" style="margin-left: 21pc;margin-top:2pc;">VIEW ALL</button> 
											 </div> 

											
										</div>
									</div>
									<div class="tab-pane fade" id="layout-list" role="tabpanel">
										<div class="products-list list">
											@foreach (var item in Model.Products.OrderByDescending(x => x.CreatedDate).Take(6))
											{
												<div class="products-entry clearfix product-wapper">
													<div class="row">
														<div class="col-md-4">
															<div class="products-thumb">
																<div class="product-lable">
																	<div class="hot">@item.Tags.FirstOrDefault()</div>
																</div>
																<div class="product-thumb-hover">
																	<a asp-controller="ProductDetail" asp-action="Index" asp-route-id="@item.Id">
																		<img width="600" height="600" src="@item.MainImage" class="post-image" alt="">
																		<img width="600" height="600" src="@item.Images.Where(img => img != item.MainImage).FirstOrDefault()" class="hover-image back" alt="">
																	</a>
																</div>
																<span class="product-quickview" data-title="Quick View">
																	<a href="#" class="quickview quickview-button">Quick View <i class="icon-search"></i></a>
																</span>
															</div>
														</div>
														<div class="col-md-8">
															<div class="products-content">
																<h3 class="product-title"><a href="shop-details.html">@item.Name</a></h3>
																<span class="price">@item.Price</span>
																<div class="rating">
																	<div class="star star-5"></div>
																	<div class="review-count">
																		(1<span> review</span>)
																	</div>
																</div>
																<div class="product-button">
																	<div class="btn-add-to-cart" data-title="Add to cart">
																		<a rel="nofollow" href="#" class="product-btn button">Add to cart</a>
																	</div>
																	<div class="btn-wishlist" data-title="Wishlist">
																		<button class="product-btn">Add to wishlist</button>
																	</div>
																	<div class="btn-compare" data-title="Compare">
																		<button class="product-btn">Compare</button>
																	</div>
																</div>
																<div class="product-description">@item.Description</div>
															</div>
														</div>
													</div>
												</div>

											}

											<div class="btn-all">
												<a class="button-outline" href="shop-grid-left.html" style="margin-left: 21pc;margin-top:2pc;">VIEW ALL</a>
											</div>

										</div>
									</div>
								</div>							
							</div>
						</div>
					</div>
				</div>
			</div><!-- #content -->
		</div><!-- #primary -->
	</div><!-- #main-content -->
</div>


<script>
	function sortProducts(sortType) {
		let currentUrl = new URL(window.location.href);
		currentUrl.searchParams.set("sortType", sortType);

		fetch(currentUrl.toString())
			.then(response => response.text())
			.then(data => {
				let parser = new DOMParser();
				let doc = parser.parseFromString(data, "text/html");
				document.getElementById("productsContainer").innerHTML = doc.getElementById("productsContainer").innerHTML;

				// Şəkillərin itməməsi üçün img src yeniləyək
				let productImages = doc.querySelectorAll(".product-thumb img");
				document.querySelectorAll(".product-thumb img").forEach((img, index) => {
					img.src = productImages[index].src;
				});
			})
			.catch(error => console.error("Error fetching sorted products:", error));
	}
</script>


<script>
	function filterProducts(categoryName, brandName, tagName, colorName) {
		let queryParams = [];
		if (categoryName) queryParams.push(`categoryName=${encodeURIComponent(categoryName)}`);
		if (brandName) queryParams.push(`brandName=${encodeURIComponent(brandName)}`);
		if (tagName) queryParams.push(`tagName=${encodeURIComponent(tagName)}`);
		if (colorName) queryParams.push(`colorName=${encodeURIComponent(colorName)}`);

		let queryString = queryParams.join("&");
		let url = `/Shop/Index?${queryString}`;

		fetch(url)
		.then(response => response.text())
		.then(data => {
			let parser = new DOMParser();
			let doc = parser.parseFromString(data, "text/html");
			document.getElementById("productsContainer").innerHTML = doc.getElementById("productsContainer").innerHTML;
		})
		.catch(error => console.error("Error fetching products:", error));
	}
</script>

